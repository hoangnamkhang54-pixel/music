<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Khang Music Pro</title>
    <style>
        :root { --primary: #00d2ff; --bg: #050505; }
        body { margin: 0; background: var(--bg); color: white; font-family: sans-serif; }
        .container { max-width: 600px; margin: auto; padding: 15px; }
        
        /* PLAYER CHÍNH */
        #player-box { 
            display: none; background: #111; border-radius: 20px; 
            padding: 20px; border: 1px solid var(--primary); margin-bottom: 20px;
        }
        .player-flex { display: flex; flex-direction: column; align-items: center; gap: 15px; }
        #p-img { width: 200px; height: 200px; border-radius: 15px; border: 2px solid var(--primary); object-fit: cover; }
        
        .lyrics-window { 
            width: 100%; height: 120px; overflow-y: auto; background: #000; 
            border-radius: 10px; padding: 10px; font-size: 14px; color: #aaa;
            border: 1px solid #333; line-height: 1.6;
        }

        /* TÌM KIẾM */
        .search-bar { display: flex; gap: 10px; margin-bottom: 20px; }
        input { flex: 1; padding: 12px; border-radius: 25px; border: 1px solid var(--primary); background: #000; color: #fff; outline: none; }
        button { padding: 0 20px; border-radius: 25px; border: none; background: var(--primary); font-weight: bold; }

        /* DANH SÁCH */
        .song-card { 
            display: flex; align-items: center; gap: 10px; background: #1a1a1a; 
            padding: 10px; border-radius: 12px; margin-bottom: 10px; cursor: pointer;
        }
        .song-card img { width: 60px; height: 60px; border-radius: 8px; }
        .song-info { flex: 1; overflow: hidden; }
        .song-info b { display: block; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; color: var(--primary); }
    </style>
</head>
<body>

<div class="container">
    <h2 style="text-align: center; color: var(--primary);">KHANG-MUSIC.COM</h2>

    <div id="player-box">
        <div class="player-flex">
            <img id="p-img" src="">
            <div style="width: 100%; text-align: center;">
                <h3 id="p-title" style="margin: 5px 0;"></h3>
                <div id="p-artist" style="color: #888; font-size: 14px; margin-bottom: 10px;"></div>
                <audio id="main-audio" controls style="width: 100%;"></audio>
                <div class="lyrics-window" id="lyrics-box">Lời bài hát sẽ hiện ở đây...</div>
            </div>
        </div>
    </div>

    <div class="search-bar">
        <input type="text" id="query" placeholder="Tìm tên bài hát...">
        <button onclick="doSearch()">TÌM</button>
    </div>

    <div id="results"></div>
</div>

<script>
    const KEY = "AIzaSyCXN0nU" + "Fr76ntM2kyOH" + "ZGSHyccvpHN0nR0";
    const audio = document.getElementById('main-audio');

    async function doSearch() {
        const q = document.getElementById('query').value;
        if(!q) return;
        const resDiv = document.getElementById('results');
        resDiv.innerHTML = "Đang quét tín hiệu...";

        try {
            const url = `https://www.googleapis.com/youtube/v3/search?part=snippet&maxResults=10&q=${q}&type=video&key=${KEY}`;
            const data = await fetch(url).then(r => r.json());
            
            resDiv.innerHTML = "";
            data.items.forEach(item => {
                const div = document.createElement('div');
                div.className = 'song-card';
                const title = item.snippet.title;
                const thumb = item.snippet.thumbnails.high.url;
                const channel = item.snippet.channelTitle;
                const id = item.id.videoId;

                div.onclick = () => playSong(title, channel, thumb, id);
                div.innerHTML = `<img src="${thumb}"><div class="song-info"><b>${title}</b><small>${channel}</small></div>`;
                resDiv.appendChild(div);
            });
        } catch (e) { resDiv.innerHTML = "Lỗi tìm kiếm, thử lại sau!"; }
    }

    async function playSong(title, artist, img, id) {
        document.getElementById('player-box').style.display = 'block';
        document.getElementById('p-title').innerText = title;
        document.getElementById('p-artist').innerText = artist;
        document.getElementById('p-img').src = img;
        
        // Dùng server trung gian mới để lấy link MP3 ổn định hơn
        audio.src = `https://api.v2.vevioz.com/@api/button/mp3/${id}`;
        audio.play().catch(() => alert("Nhấn Play để nghe nhạc!"));

        window.scrollTo({top: 0, behavior: 'smooth'});

        // Lấy lời
        const lBox = document.getElementById('lyrics-box');
        lBox.innerText = "Đang tải lời...";
        try {
            // Tách tên bài và ca sĩ từ tiêu đề Youtube
            const cleanTitle = title.split('|')[0].split('-')[0].trim();
            const lRes = await fetch(`https://api.lyrics.ovh/v1/${artist}/${cleanTitle}`).then(r => r.json());
            lBox.innerText = lRes.lyrics || "Không tìm thấy lời bài hát này.";
        } catch { lBox.innerText = "Không tìm thấy lời."; }
    }
</script>
</body>
</html>
